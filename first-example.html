---
active_crumb: First Example
layout: documentation
id: first_example
---

<!--
 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.
 The ASF licenses this file to You under the Apache License, Version 2.0
 (the "License"); you may not use this file except in compliance with
 the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<div class="col-md-8 second-column">
    <section id="setup">
        <h2 class="section-title">Project Setup</h2>
        <p>
            Let's setup a project for our first example with the following assumptions:
        </p>
        <ul>
            <li>We'll use Mac OS/Linux environment</li>
            <li>We'll use Scala to implement our model</li>
            <li>We'll use <a target=_ href="https://maven.apache.org/install.html">Maven</a> to create and build our project</li>
            <li>We'll use <a target=_ href="https://www.jetbrains.com/idea/">JetBrains IDEA</a> as our Scala/Java IDE (any IDE would work the same way)</li>
        </ul>
    </section>
    <section id="new_project">
        <h3 class="section-title">Create New Project</h3>
        <p>
            You can create new Maven-based project in many different ways - we'll use maven archetype generation
            for that. In your home folder run the following command:
        </p>
        <pre class="brush: text">
            mvn archetype:generate -DgroupId=examples -DartifactId=my-app -DarchetypeVersion=1.4 -DinteractiveMode=false
        </pre>
        <p>
            This will create <code>my-app</code> folder with the following default maven project structure:
        </p>
        <pre class="console">
├── <b>pom.xml</b>
└── src
    ├── main
    │   └── java
    │       └── examples
    │           └── App.java
    └── test
        └── java
            └── examples
                └── AppTest.java
        </pre>
        <p>
            Create new IDEA project from this source folder (make sure to pick JDK 8 or later JDK and language support).
            Let's also delete auto-generated files <code>App.java</code> and <code>AppTest.java</code> from our
            project as we won't be using them.
        </p>
    </section>
    <section id="add_nlpcraft">
        <h3 class="section-title">Add NLPCraft</h3>
        <p>
            We need to add NLPCraft dependency to our new project. Open <code>pom.xml</code> file and replace
            <code>dependencies</code> section with the following code:
        </p>
        <pre class="brush: xml, highlight: [3, 4, 5]">
            &lt;dependencies&gt;
                &lt;dependency&gt;
                    &lt;groupId&gt;org.apache.nlpcraft&lt;/groupId&gt;
                    &lt;artifactId&gt;nlpcraft&lt;/artifactId&gt;
                    &lt;version&gt;{{site.latest_version}}&lt;/version&gt;
                &lt;/dependency&gt;
            &lt;/dependencies&gt;
        </pre>
        <p>
            Also make sure that you have correct JDK version (11 or above) for the
            <a target="asf" href="https://maven.apache.org/plugins/maven-compiler-plugin/examples/set-compiler-source-and-target.html">maven compiler plugin</a>:
        </p>
        <pre class="brush: xml, highlight: [3, 4]">
            &lt;properties&gt;
                &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
                &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;
                &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;
            &lt;/properties&gt;
        </pre>
        <p>
            IDEA should automatically reload the project with newly updated <code>pom.xml</code> file and
            we should be ready now to develop our new first data model.
        </p>
    </section>
    <section id="data_model">
        <h2 class="section-title">Data Model</h2>
        <p>
            For our example we'll develop a prototypical light switch that can be controlled through the natural language.
            We'll keep <a target=_ href="https://cloud.google.com/speech-to-text/">speech-to-text conversion</a> and integration
            with <a target=_    href="https://developer.apple.com/homekit/">HomeKit</a> or
            <a href="https://www.arduino.cc/" target=_>Ardunio</a> outside of this example - and concentrate only on understanding the natural
            language commands. At the end, we should be able to say <code>"Turn the lights off in the guest bedroom"</code>
            or <code>"Could you please switch off all the lights?"</code>
        </p>
        <p>
            In NLPCraft a data model is simply an implementation of <a target="javadoc" href="/apis/latest/org/apache/nlpcraft/model/NCModel.html">NCModel</a>
            interface. You can move most of the model configuration out to an external JSON or YAML file and use
            <a target="javadoc" href="/apis/latest/org/apache/nlpcraft/model/NCModelFileAdapter.html">NCModelFileAdapter</a> to
            load this external configuration when creating a new model. Note that this is a canonical pattern to build
            models in NLPCraft and it allows you cleanly separate the logic of the model from its declarative configuration.
        </p>
        <p>
            Let's add new <code>lightswitch_model.yml</code> file containing our model's static configuration in YAML
            into <code>src/main/java/examples</code> folder with the following content:
        </p>
        <pre class="brush: js, highlight: [14, 21, 28]">
            id: "nlpcraft.lightswitch.ex"
            name: "Light Switch Example Model"
            version: "1.0"
            description: "NLI-powered light switch example model."
            macros:
              - name: "&lt;ACTION&gt;"
                macro: "{turn|switch|dial|control|let|set|get|put}"
              - name: "&lt;ENTIRE_OPT&gt;"
                macro: "{entire|full|whole|total|*}"
              - name: "&lt;LIGHT&gt;"
                macro: "{it|them|light|illumination|lamp|lamplight}"
            enabledBuiltInTokens: [] # Don't use any built-in tokens.
            elements:
              - id: "ls:loc"
                description: "Location of lights."
                synonyms:
                  - "&lt;ENTIRE_OPT&gt; {upstairs|downstairs|*} {kitchen|library|closet|garage|office|playroom|{dinning|laundry|play} room}"
                  - "&lt;ENTIRE_OPT&gt; {upstairs|downstairs|*} {master|kid|children|child|guest|*} {bedroom|bathroom|washroom|storage} {closet|*}"
                  - "&lt;ENTIRE_OPT&gt; {house|home|building|{1st|first} floor|{2nd|second} floor}"

              - id: "ls:on"
                group: "act"
                description: "Light switch ON action."
                synonyms:
                  - "&lt;ACTION&gt; &lt;LIGHT&gt; on"
                  - "&lt;ACTION&gt; on &lt;LIGHT&gt;"

              - id: "ls:off"
                group: "act"
                description: "Light switch OFF action."
                synonyms:
                  - "&lt;ACTION&gt; &lt;LIGHT&gt; {off|out}"
                  - "{&lt;ACTION&gt;|shut|kill|stop|eliminate} {off|out} &lt;LIGHT&gt;"
                  - "no &lt;LIGHT&gt;"
        </pre>
        <p>
            Notice three semantic model elements that we'll use later in our intent definition (lines 14, 21, and 28):
        </p>
        <ul>
            <li><code>ls:loc</code></li>
            <li><code>ls:on</code></li>
            <li><code>ls:off</code></li>
        </ul>
        <p>
            Model element <code>ls:loc</code> defines a location where we want to control the lights. Model
            elements <code>ls:on</code> and <code>ls:off</code> define corresponding "on" and "off" lights
            actions. We'll use these elements in our model's intent-based matching logic.
        </p>
        <p>
            Next let's go ahead and add model's logic which we'll write in Scala (this code can be converted to Java or Kotlin almost as is).
            Create new <code>LightSwitchModel.scala</code> file along side
            <code>lightswitch_model.json</code> configuration file and copy the following model code into it:
        </p>
        <pre class="brush: java, highlight: [5, 6, 7, 21, 22]">
package examples

import org.apache.nlpcraft.model.{NCIntentTerm, _}

class LightSwitchModel extends NCModelFileAdapter("examples/lightswitch_model.yaml") {
    @NCIntent("intent=ls term(act)={groups @@ 'act'} term(loc)={id == 'ls:loc'}*")
    @NCIntentSample(Array(
        "Turn the lights off in the entire house.",
        "Switch on the illumination in the master bedroom closet.",
        "Get the lights on.",
        "Please, put the light out in the upstairs bedroom.",
        "Set the lights on in the entire house.",
        "Turn the lights off in the guest bedroom.",
        "Could you please switch off all the lights?",
        "Dial off illumination on the 2nd floor.",
        "Please, no lights!",
        "Kill off all the lights now!",
        "No lights in the bedroom, please."
    ))
    def onMatch(
        @NCIntentTerm("act") actTok: NCToken,
        @NCIntentTerm("loc") locToks: List[NCToken]
    ): NCResult = {
        val status = if (actTok.getId == "ls:on") "on" else "off"
        val locations =
            if (locToks.isEmpty)
                "entire house"
            else
                locToks.map(_.meta[String]("nlpcraft:nlp:origtext")).mkString(", ")

        // Add HomeKit, Arduino or other integration here.

        // By default - just return a descriptive action string.
        NCResult.text(s"Lights '$status' in '${locations.toLowerCase}'.")
    }
}
        </pre>
        <p>
            Chapter <a href="/data-model.html">Data Model</a> will provide detailed explanation on how
            data models work. Here are few comments as to what this code does and how it is organized:
        </p>
        <ul>
            <li>
                On line 5 we use <a target="javadoc" href="/apis/latest/org/apache/nlpcraft/model/NCModelFileAdapter.html">NCModelFileAdapter</a>
                to load its configuration from the external <code>examples/lightswitch_model.yaml</code> YAML file.
            </li>
            <li>
                Our data model uses intent-based matching of the user input. Intent is a template and a callback for when
                a template is matched against user input:
                <ul>
                    <li>
                        Line 6 uses <a target="javadoc" href="/apis/latest/org/apache/nlpcraft/model/NCIntent.html">@NCIntent</a>
                        annotation to define the intent (it can also be defined in the external model definition).
                        The intent defined here matches
                        two parts: first should be any token belonging to <code>act</code> group (i.e. "on" or "off" action),
                        and the second should be a zero or more tokens with ID equal to <code>ls:loc</code> (i.e. optional list of locations).
                    </li>
                    <li>
                        Line 7 uses <a target="javadoc" href="/apis/latest/org/apache/nlpcraft/model/NCIntentSample.html">@NCIntentSample</a>
                        annotation that provides a list of sample inputs that should satisfy the intent above. Although this
                        annotation is optional, the list of samples serves two important purposes:
                        <ul>
                            <li>
                                It provides documentation for the intent by listing examples of input sentences that this intent should match on.
                            </li>
                            <li>
                                It can also be used for auto-testing of the model. See below the <a href="#test">testing</a>
                                section for details.
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                Lines 21 and 22 use <a target="javadoc" href="/apis/latest/org/apache/nlpcraft/model/NCIntent.html">@NCIntentTerm</a>
                annotations to connect the matched result with a callback method formal parameters.
            </li>
            <li>
                When our intent is selected as a matching winner the method <code>onMatch(...)</code> on line 20 is invoked. It simply
                returns a text response that indicates the light status at a requested location. That's where you can
                also add <a target=_ href="https://developer.apple.com/homekit/">HomeKit</a>,
                <a href="https://www.arduino.cc/" target=_>Ardunio</a> or other integrations to make a real
                lightswitch in your home.
            </li>
        </ul>
    </section>
    <section id="server">
        <h3 class="section-title">Start REST Server</h3>
        <p>
            REST server listens for requests from client applications and routes them to the requested data models
            via connected data probes. REST server starts the same way as the data probe. Configure new
            Run Configuration in IDEA with the following parameters:
        </p>
        <ul>
            <li>
                <b>Main class:</b> <code>org.apache.nlpcraft.NCStart</code>
            </li>
            <li>
                <b>Program arguments: </b> <code>-server</code>
            </li>
        </ul>
        <p>
            Once started ensure that your REST server console output shows that data probe is connected and the
            REST server is listening on the default <code>localhost:8081</code> endpoint.
        </p>
        <p>
            At this point we've developed our data model, deployed it into the data probe, and started the REST server.
            Our NLI-based light switch is ready to accept user requests. Instead of using direct REST calls we'll
            demonstrate the built-in <a href="/tools/test_framework.html">test framework</a> that allows you to write
            convenient unit tests against your data model.
        </p>
    </section>
    <section id="test">
        <h3 class="section-title">Testing</h3>
        <p>
            Let's develop a unit test for our model. Remember the <a target="javadoc" href="/apis/latest/org/apache/nlpcraft/model/NCIntentSample.html">@NCIntentSample</a>
            annotation we have used in our Scala code next to intent definition? Auto-testing utility is relying on it.
        </p>
        <p>
            Part of the <a href="/tools/test_framework.html">test framework</a>, the auto-validator class <a
                target="javadoc"
                href="/apis/latest/org/apache/nlpcraft/model/tools/test/NCTestAutoModelValidator.html">NCTestAutoModelValidator</a> takes one or more model IDs
            (or class names) and performs validation. Validation consists of starting an embedded probe with a given model,
            scanning for <a target="javadoc" href="/apis/latest/org/apache/nlpcraft/model/NCIntentSample.html">@NCIntentSample</a> annotations
            and their corresponding callback methods, submitting each sample input
            sentences from <a target="javadoc" href="/apis/latest/org/apache/nlpcraft/model/NCIntentSample.html">@NCIntentSample</a>
            annotation and checking that resulting intent matches the intent the sample was attached to.
        </p>
        <p>
            Note that auto-testing does not require any additional code to be written - the class gathers all required information from the model
            itself.
        </p>
        <p>
            Let's configure IDEA Runtime Configuration (remember - there's no need to write any additional code here):
        </p>
        <ul>
            <li>
                <b>Main class:</b> <code>org.apache.nlpcraft.model.tools.test.NCTestAutoModelValidator</code>
            </li>
            <li>
                <b>VM options: </b> <code>-DNLPCRAFT_TEST_MODELS=examples.LightSwitchModel</code>
            </li>
        </ul>
        <div class="bq info">
            <p><b>Embedded Probe</b></p>
            <p>
                This test (as well as manual test client from <a href="/tools/test_framework.html">test framework</a>) use
                <a href="/tools/embedded_probe.html">embedded probe</a> which automatically
                starts and stops the data probe from within the tests itself. However, when not testing you will need
                to start data probe separately.
            </p>
            <p>
                <b>NOTE:</b> when using this test you don't need to start data probe standalone.
            </p>
        </div>
        <p>
            Start this Runtime Configuration and you should be getting standard log in the output console.
        </p>
    </section>
    <section>
        <h2 class="section-title">Congratulation! 👌</h2>
        <p>
            You've created your first data model, deployed it into the data probe, started the
            REST server and tested the model using built-in model auto-validator.
        </p>
    </section>
</div>
<div class="col-md-2 third-column">
    <ul class="side-nav">
        <li class="side-nav-title">On This Page</li>
        <li><a href="#setup">Project Setup</a></li>
        <li><a href="#data_model">Data Model</a></li>
        <li><a href="#server">Start Server</a></li>
        <li><a href="#test">Testing</a></li>
        {% include quick-links.html %}
    </ul>
</div>




