---
active_crumb: SQL Model <code><sub>ex</sub></code>
layout: documentation
id: sql_model
---

<!--
 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.
 The ASF licenses this file to You under the Apache License, Version 2.0
 (the "License"); you may not use this file except in compliance with
 the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<div class="col-md-8 second-column">
    <section id="overview">
        <h2 class="section-title">Overview</h2>
        <p>
            This example demonstrates a relatively complete implementation of natural language interface to a
            SQL database. This is a non-trivial example, spanning over a  thousand lines of code, and it can
            act as a basis for production-ready implementation.
        </p>
        <p>
            Note that a significant part of the implementation is not directly related to NLPCraft but rather deals
            with SQL statement construction. We specifically decided not to use any 3rd party libraries for it to
            show what can be done "from scratch".
        </p>
        <p>
            Complexity: <span class="complexity-three-star"><i class="fas fa-gem"></i> <i class="fas fa-gem"></i> <i class="fas fa-gem"></i></span><br/>
            Source code: <a target="github" href="https://github.com/apache/incubator-nlpcraft/tree/master/nlpcraft/src/main/scala/org/apache/nlpcraft/examples/sql">GitHub</a>
        </p>
    </section>
    <section id="background">
        <h2 class="section-title">Background</h2>
        <p>
            Many of modern existing natural language-to-SQL implementations use variations of
            deep learning approach where you first train the neural network on a pre-created training set and
            then get to use the trained network to provide (infer) probabilistic answers for the new input sentences. Although the latest
            attempts to implement this approach are getting into 90% percentile of accuracy - they remain largely
            unusable for the vast swath of enterprise applications where non-deterministic nature of such systems
            renders them practically useless. The apparent problem with non-deterministic systems like that is that the user
            never knows whether a given answer is correct or incorrect. In these business and enterprise
            use cases users can't tolerate the fact that
            in 5-10% of the cases the answer will be invalid. Try that for your HR or revenue reporting system,
            prescriptive analytics systems, and so on...
        </p>
        <p>
            It's important to note, however, that for many non-mission-critical systems such non-determinism does
            not pose a significant problem. We happily accept such imprecision when asking for direction on our
            mobile devices, unlock our phones using face or fingerprint recognition, when performing sentiment
            analysis or trying to detect faces of our friends across thousands of photographs. Cost of retries,
            as well as the cost of initial errors, is insignificant in these cases. The same cost, however, in many business
            and enterprise applications can be too significant to tolerate.
        </p>
        <p>
            As you may have learned by now, NLPCraft uses a <i>fully deterministic approach</i> in an attempt to
            match the user input against a defined set of intents. If it finds the matching intent - it guarantees that
            match for a given intent declaration. If no matching intent can be found - it returns the negative
            result without any ambiguity. In other words, if the answer is given, it is guaranteed to be correct.
            Another positive side-effect of this approach is the fact that such matching logic is easily traceable, i.e.
            the user can easily see why given user input was matched against a certain intent (and not any other). Such
            traceability of the comprehension logic (or explainability vs "black box" approach resulting from deep
            learning techniques) is often critical for many real-life business applications.
        </p>
        <p>
            On the flip side, one of the downsides of such an approach in general is the need to have a detailed,
            domain-specific semantic model
            for each SQL database (when dealing with SQL databases). Building such a
            model can be a non-trivial and time consuming experience. That is where NLPCraft brings a lot of built-in tooling
            and machinery to simplify this task dramatically.
        </p>
    </section>
    <section id="new_project">
        <h3 class="section-title">Create New Project</h3>
        <p>
            You can create new Java project in many different ways - we'll use Maven archetype generation
            for that. In your home folder run the following command:
        </p>
        <pre class="brush: text">
            mvn archetype:generate -DgroupId=examples -DartifactId=my-app -DarchetypeVersion=1.4 -DinteractiveMode=false
        </pre>
        <p>
            This will create <code>my-app</code> folder with the following default maven project structure:
        </p>
        <pre class="console">
â”œâ”€â”€ <b>pom.xml</b>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚Â Â  â””â”€â”€ java
    â”‚Â Â      â””â”€â”€ examples
    â”‚Â Â          â””â”€â”€ App.java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ examples
                â””â”€â”€ AppTest.java
        </pre>
        <div class="bq info">
            <p>
                Note that this setup is same for all examples. Note also that you can use any other tools for
                creating and managing Java project with or without Maven.
            </p>
        </div>
        <p>
            For our example we'll use JetBrain's <a target=_new href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>.
            Create new IDEA project from this source folder (make sure to pick JDK 8 or later JDK and language support).
            Let's also delete auto-generated files <code>App.java</code> and <code>AppTest.java</code> from our
            project as we won't be using them.
        </p>
    </section>
    <section id="add_nlpcraft">
        <h3 class="section-title">Add NLPCraft</h3>
        <p>
            Next we need to add NLPCraft dependency to our new project. Open <code>pom.xml</code> file and replace
            <code>dependencies</code> section with the following code:
        </p>
        <pre class="brush: xml, highlight: [3, 4, 5]">
            &lt;dependencies&gt;
                &lt;dependency&gt;
                    &lt;groupId&gt;org.apache.nlpcraft&lt;/groupId&gt;
                    &lt;artifactId&gt;nlpcraft&lt;/artifactId&gt;
                    &lt;version&gt;{{site.latest_version}}&lt;/version&gt;
                &lt;/dependency&gt;
            &lt;/dependencies&gt;
        </pre>
        <p>
            Also make sure that you have correct JDK version (1.8 or above) for the maven compiler plugin:
        </p>
        <pre class="brush: xml, highlight: [3, 4]">
            &lt;properties&gt;
                &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
                &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
                &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
            &lt;/properties&gt;
        </pre>
        <p>
            IDEA should automatically reload the project with newly updated <code>pom.xml</code> file and
            we should be ready now to develop our data model.
        </p>
    </section>
    <section id="sql">
        <h3 class="section-title">Sample Database</h3>
        <p>
            We are going to be building natural language interface against slightly modified "Northwind" sample database
            from <a target="_" href="https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql/linq/downloading-sample-databases#get-the-northwind-sample-database-for-sql-server">Microsoft SQL Server</a>:
        </p>
        <figure>
            <img class="img-fluid" src="/images/sql_example_model.png" alt="">
            <figcaption><b>Fig 1.</b> SQL Schema</figcaption>
        </figure>
        <p>
            You can find SQL script creating this database and populating it with the sample data at <code>db/northwind.sql</code>
            file in the root of the example.
        </p>
    </section>
    <section id="h2">
        <h3 class="section-title">H2 Database</h3>
        <p>
            In our example we'll be using H2 database instance. For convenience, example provides a command line application <code>db/SqlServer.java</code>
            that automatically starts local H2 database instance with default configuration (localhost on port 9092) and initializes it
            using <code>db/northwind.sql</code> script.
        </p>
    </section>
    <section id="model">
        <h3 class="section-title">Data Model</h3>
    </section>
    <section>
        <h2 class="section-title">Done! ðŸ‘Œ</h2>
        <p>
            You've created a data model for fairly complete natural language interface to SQL database, deployed it into the data probe, started the
            REST server and tested this model using JUnit 5 and the built-in test framework.
        </p>
    </section>
</div>
<div class="col-md-2 third-column">
    <ul class="side-nav">
        <li class="side-nav-title">On This Page</li>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#background">Background</a></li>
        <li><a href="#new_project">New Project</a></li>
        <li><a href="#add_nlpcraft">Add NLPCraft</a></li>
        <li><a href="#model">Data Model</a></li>
        <li><a href="#code">Model Class</a></li>
        <li><a href="#tools">External Tools</a></li>
        <li><a href="#start_probe">Start Probe <sub>opt</sub></a></li>
        <li><a href="#start_server">Start Server</a></li>
        <li><a href="#testing">Testing</a></li>
        {% include quick-links.html %}
    </ul>
</div>






