---
active_crumb: Test Framework
layout: documentation
id: test_framework
---

<!--
 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.
 The ASF licenses this file to You under the Apache License, Version 2.0
 (the "License"); you may not use this file except in compliance with
 the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<div class="col-md-8 second-column">
    <section id="overview">
        <h2 class="section-title">Overview</h2>
        <p>
            NLPCraft comes built-in with a simple to use testing framework that can be easily used with any
            popular unit testing JVM frameworks such as <a href="https://testng.org">TestNG</a> or
            <a href="https://junit.org">JUnit</a>. Test framework is essentially a simplified implementation
            of the REST client tailor made for model unit testing.
        </p>
        <p>
            Test framework consists of the following types in <code>org.apache.nlpcraft.model.tools.test</code> package:
        </p>
        <ul>
            <li>
                Auto-testing:
                <ul>
                    <li>
                        <a
                            target="javadoc"
                            href="/apis/latest/org/apache/nlpcraft/model/tools/test/NCTestAutoModelValidator.html">
                            NCTestAutoModelValidator
                        </a> - auto-runner for model tests based on <code>@NCIntentSample</code> annotation.
                    </li>
                </ul>
            </li>
            <li>
                Using test client directly:
                <ul>
                    <li>
                        <a
                            target="javadoc"
                            href="/apis/latest/org/apache/nlpcraft/model/tools/test/NCTestClient.html">
                            NCTestClient
                        </a> - main model test client interface.
                    </li>
                    <li>
                        <a
                            target="javadoc"
                            href="/apis/latest/org/apache/nlpcraft/model/tools/test/NCTestClientBuilder.html">
                            NCTestClientBuilder
                        </a> - builder for <code>NCTestClient</code> instances.
                    </li>
                    <li>
                        <a
                            target="javadoc"
                            href="/apis/latest/org/apache/nlpcraft/model/tools/test/NCTestClientResult.html">
                            NCTestClientResult
                        </a> - result holder of the test sentence processing.
                    </li>
                    <li>
                        <a
                            target="javadoc"
                            href="/apis/latest/org/apache/nlpcraft/model/tools/test/NCTestClientException.html">
                            NCTestClientException
                        </a> - exception used by the test framework.
                    </li>

                </ul>
        </ul>
    </section>
    <section id="usage">
        <h2 class="section-title">Test client</h2>
        <p>
            Here's a code for unit test using test client for the model from <a href="/examples/alarm_clock.html">Alarm Clock</a>
            example illustrating the usage of test framework together with JUnit 5:
        </p>
            <pre class="brush: java, highlight: [8, 10, 16, 24, 25, 26]">
public class AlarmTest {
    private NCTestClient cli;

    &#64;BeforeEach
    void setUp() throws NCException, IOException {
        NCEmbeddedProbe.start(AlarmModel.class);

        cli = new NCTestClientBuilder().newBuilder().build();

        cli.open("nlpcraft.alarm.ex");
    }

    &#64;AfterEach
    void tearDown() throws NCException, IOException {
        if (cli != null)
            cli.close();

        NCEmbeddedProbe.stop();
    }

    &#64;Test
    public void test() throws NCException, IOException {
        // Should be passed.
        assertTrue(cli.ask("Ping me in 3 minutes").isOk());
        assertTrue(cli.ask("Buzz me in an hour and 15mins").isOk());
        assertTrue(cli.ask("Set my alarm for 30s").isOk());
    }
}
        </pre>
        <p>
            Notes:
        </p>
        <ul>
            <li>
                Before each unit test execution on line 8 we create new instance of <code>NCTestClient</code> using
                client builder with default configuration. On line 10 we open test client connection for model
                with ID <code>nlpcraft.alarm.ex</code>.
            </li>
            <li>
                After each test execution we close test client connection on line 16.
            </li>
            <li>
                On lines 24-26 we submit ("ask") test sentences to our model and check for succesfull processing.
            </li>
        </ul>
        <div class="bq info">
            <p>
                <b>Embedded Probe</b>
            </p>
            <p>
                Note that this example (lines 6 and 18), as all other examples shipped with NLPCraft, uses
                <a href="embedded_probe.html">Embedded Probe</a>.
            </p>
            <p>
                Typically, data probes are launched in their own independent JVMs. However, in some
                cases - e.g. during unit testing - it is more convenient for model implementation or preferable
                for performance reasons to host a data model (and hence the data probe) in the same JVM.
            </p>
        </div>
    </section>
    <section id="autotest">
        <h2 class="section-title">Auto Model Validation</h2>
        <p>
            The same model from <a href="/examples/alarm_clock.html">Alarm Clock</a> example can be auto validated using
            <a target="javadoc" href="/apis/latest/org/apache/nlpcraft/model/tools/test/NCTestAutoModelValidator.html">NCTestAutoModelValidator</a>
            class and the <code>@NCIntentSample</code> annotation from the model's callback method:
        </p>
        <pre class="brush: java, highlight: [4, 5, 6]">
public class AlarmModel extends NCModelFileAdapter {
    @NCIntentRef("alarm")
    @NCIntentSample({
        "Ping me in 3 minutes",
        "Buzz me in an hour and 15mins",
        "Set my alarm for 30s"
    })
    NCResult onMatch(
        NCIntentMatch ctx,
        @NCIntentTerm("nums") List&lt;NCToken&gt; numToks
    ) {
      // ...
    }
}
        </pre>
        <p>
            Auto model validator
            will scan the model for its callback methods, collect all samples from <code>@NCIntentSample</code> annotations, and
            will submit each sample and check that correct intent is selected as the winning match. Notice that this auto validation
            does not require any additional code to be written - the tool gathers all required information from the model
            itself.
        </p>
        <p>
            Add necessary classpath to and run:
        </p>
        <pre class="brush: plain">
java -ea -DNLPCRAFT_TEST_MODELS=org.apache.nlpcraft.examples.alarm.AlarmModel org.apache.nlpcraft.model.tools.test.NCTestAutoModelValidator
        </pre>
        <p>
            Notes:
        </p>
        <ul>
            <li>
                When running auto validator from command line you set models to test via <code>NLPCRAFT_TEST_MODELS</code>
                system property that should contain comma separate list of the data model classes.
            </li>
        </ul>
        <p>
            In the log output you should see the following validation results:
        </p>
        <figure>
            <img class="img-fluid-no-border" src="/images/auto_validation.png" alt="">
            <figcaption><b>Fig 1.</b> Model Auto-Validation Result.</figcaption>
        </figure>
        <p>
            See <a target="javadoc" href="/apis/latest/org/apache/nlpcraft/model/tools/test/NCTestAutoModelValidator.html">NCTestAutoModelValidator</a>
            class for more details.
        </p>
    </section>
    <section id="examples">
        <h2 class="section-title">Examples</h2>
        <p>
            All <a target="github" href="https://github.com/apache/incubator-nlpcraft/tree/master/nlpcraft/src/main/scala/org/apache/nlpcraft/examples">examples</a>
            shipped with NLPCraft come with instructions on how to auto-validate their models.
        </p>
    </section>
</div>
<div class="col-md-2 third-column">
    <ul class="side-nav">
        <li class="side-nav-title">On This Page</li>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#usage">Test client</a></li>
        <li><a href="#autotest">Auto model validation</a></li>
        <li><a href="#examples">Examples</a></li>
        {% include quick-links.html %}
    </ul>
</div>






